# ΠΜΔΚ 2023 - Αδύναμες Κλειδαριές

Ανοίγοντας το `script.py`, βλέπουμε πως το `data.txt` είναι κρυπτογραφημένο με ένα RSA κλειδί, για το οποίο χρησιμοποιούνται δύο τυχαίοι 96 bit πρώτοι αριθμοί `p` και `q`. Το δημόσιο κλειδί που μας δίνεται (στο `pubkey.pem`), είναι το:

```
-----BEGIN PUBLIC KEY-----
MEswDQYJKoZIhvcNAQEBBQADOgAwNwIwMnZL0LEekBWw8c5/yzRvDujmHgQoRg/s
86q+KzaIxtbB4vVEfFg97d4pPOmi1pyZAgMBAAE=
-----END PUBLIC KEY-----
```

Χρησιμοποιώντας αυτό, λαμβάνουμε το

```
n = 7766827164805520635125241858950094311424010548137332380968738511915914989569533629765837470713676446739954738306201
```

Η πρώτη μας σκέψη για επίθεση είναι να παραγοντοποιήσουμε το `n` σε γινόμενο πρώτων (της μορφής `p^2 * q^2`). 
(εγω χρησιμοποιήσα [αυτό](https://www.alpertron.com.ar/ECM.HTM) το διαμάντι) και -να'ναι καλά οι ελλειπτικές καμπύλες- λαμβάνουμε, σε λιγότερο απο 2 δευτερόλεπτα, τις τιμές

```
p = 51193470365601890412069415967
q = 54438637794938840388249560603
```

Μετά έγραψα το ακόλουθο script, το οποίο υπολογίζει το αρχικό μήνυμα μέσα σε λίγα δευτερόλεπτα.

```py
import numpy as np
from Crypto.PublicKey import RSA
from Crypto.Util.number import long_to_bytes

# Τα e, p, q, n που λαμβάνουμε απο τα δεδομένα
e = 65537
p,q = 51193470365601890412069415967, 54438637794938840388249560603
n = (p**2)*(q**2)

# Η συνάρτηση Carmichael λ(n)
totient = np.lcm(p*(p-1), q*(q-1))

with open('pubkey.pem', 'r') as f:
  key = RSA.import_key(f.read())

d = pow(e, -1, totient)

# Εδώ κάνουμε ενα ad-hoc ModPow(c, d, n), όπου το c_factors περιέχει 
# τους πρώτους παράγοντες του αριθμού c (που βρίσκεται στο data.txt).
# Προφανώς βασιζόμαστε στην (αριθμοθεωρητική) ιδιότητα 
# c^d mod n = (p1^d * p2^d * ... * pk^d) mod n = (p1^d mod n) * (p2^d mod n) * ... (pk^d mod n)
c_factors_mod_n = []
c_factors = [2, 101, 1811, 2833, 614321, 300662319069071, 46881635909203037]
for p in c_factors:
  c_factors_mod_n.append(pow(p, d, n))

# Ένας παράγοντας του c έπερνε πολύ ώρα, οπότε τον έβαλα έτοιμο υπολογισμένο εδώ :P
c_factors_mod_n.append(2517000348435916083423366097155216979785138526239703054239477691212462743055697560539055864413560542792989395505783)

print(f"Decrypted: {long_to_bytes(np.prod(c_factors_mod_n) % n)}")
```

Απ'όπου λαμβάνουμε και το flag.

~ synthels
