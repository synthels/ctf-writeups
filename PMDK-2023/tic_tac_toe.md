# ΠΜΔΚ 2023 - Τρίλιζα

Ανοίγοντας την [σελίδα](https://gramthanos.github.io/pmdk-2023-challenge-tic-tac-toe/) του challenge, στο inspector tab του browser μας βλέπουμε ενα script tag, που φορτώνει το [script.js](https://gramthanos.github.io/pmdk-2023-challenge-tic-tac-toe/assets/js/script.js). Αφού το κάνουμε un-minify (καινούργιο ρήμα), μένουμε με μια γκουμούτσα μεγέθους 19.5KB, απο την οποία όμως μας ενδιαφέρουν μόνο δυο κομμάτια. Παρατηρούμε αρχικά το ακόλουθο snippet στην γραμμή `295`.

```js
_0x15151 = String[_0x4db935(0x144)]["apply"](
  String,
  Uint8Array["from"](
    [
     0xb6, 0xd3,
     0xd8, 0xc7,
     0x5b, 0x68,
     0x57, 0x47,
     0x16, 0x6f,
     0x5c, 0x5d,
     0x47, 0xc1,
     0xaa, 0xac,
     0xe1, 0x42,
     0x3c, 0x5e,
     0x11, 0x11,
     0x61, 0x5a,
     0x5b, 0x47,
     0x93, 0xad,
     0xad, 0xb8,
     0x15, 0x6d,
     0x57, 0x43,
     0x42, 0x60,
     0xc, 0x13,
  ],
  (_0x5029e9, _0x5bdc87) => _0x5029e9 ^ _0x15151[_0x5bdc87]
)
```

Το οποίο (εαν ρωτήσεις εμένα), ίσως είναι το χειρότερο μέρος να κρύψεις ένα flag. Αλλά, γιατί όχι, ας κοιτάξουμε εδώ. Άλλωστε γίνεται αρκετά φανερό πως το `_0x15151` είναι το flag, αφού απο κάτω έχουμε αυτή την γραμμή:

```js
if (_0x15151[_0x4db935(0x13b)](0x0, 0x4) != "FLAG") throw "";
```

Όπου το `(_0x15151[_0x4db935(0x13b)])()` είναι η συνάρτηση `String.substring()`. Αλλάζοντας το `throw ""` σε `console.log("Flag not found")` (ή κατι τέτοιο), βλέπουμε όμως πως τελικά το `_0x15151` δεν ξεκινάει με την λέξη "FLAG". Χμμμμ, παράξενο; Για να κοιτάξουμε πιο πάνω. Στην σειρά `230` βλέπουμε τις συνθήκες που ελέγχει για την νίκη και για την ήττα.

```js
if (
  _0x4d82db[_0x36b2f0(0x139)][0x0]["x"] == 0x3 ||
  _0x4d82db["row"][0x1]["x"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x139)][0x2]["x"] == 0x3 ||
  _0x4d82db["col"][0x0]["x"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x12d)][0x1]["x"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x12d)][0x2]["x"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x122)][0x0]["x"] == 0x3 ||
  _0x4d82db["diag"][0x1]["x"] == 0x3
)
  return (_0x5051f1 = !![]), _0x219fd9(_0x4d82db, "x"), "😿\x20You\x20Lost!";
if (
  _0x4d82db[_0x36b2f0(0x139)][0x0]["o"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x139)][0x1]["o"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x139)][0x2]["o"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x12d)][0x0]["o"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x12d)][0x1]["o"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x12d)][0x2]["o"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x122)][0x0]["o"] == 0x3 ||
  _0x4d82db[_0x36b2f0(0x122)][0x1]["o"] == 0x3
)
  return (_0x5051f1 = !![]), _0x219fd9(_0x4d82db, "o"), "🙀\x20You\x20Won!";
```

Τι θα συνέβαινε όμως, εαν, χμ, δεν ξέρω, αλλάζαμε αυτές τις γραμμές σε:

```js
if (false)
  return (_0x5051f1 = !![]), _0x219fd9(_0x4d82db, "x"), "😿\x20You\x20Lost!";
if (true)
  return (_0x5051f1 = !![]), _0x219fd9(_0x4d82db, "o"), "🙀\x20You\x20Won!";
```

Θαύμα! Θαύμα! ξαφνικά, το παιχνίδι μας flashάρει μια επιληπτική οθόνη με τις λέξεις "You Won!". Ανοίγοντας ξανά το console tab, κάνουμε ένα `console.log(String.fromCharCode(..._0x15151))` και η σελίδα μας φτύνει το flag ακριβώς μπροστά μας.

~ synthels
